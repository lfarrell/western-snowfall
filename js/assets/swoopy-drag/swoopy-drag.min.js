d3.swoopyDrag=function(){function u(a){var b=a[0].pos,c=a[2].pos;a=a[1].pos;var d=n(c,a),m=n(a,b),f=n(b,c),e=Math.acos((d*d+m*m-f*f)/(2*d*m)),d=Math.round(d*m*f/4/(.5*d*m*Math.sin(e))*1E3)/1E3;return["M",b,"A",d,d,0,+(Math.PI/2>e),+(0>(c[0]-b[0])*(a[1]-b[1])-(c[1]-b[1])*(a[0]-b[0])),c].join(" ")}function n(a,b){return Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2))}function g(a,b){a.attr("transform",function(a){return"translate("+("function"==typeof b?b(a):b)+")"})}function k(a){return function(b){return b[a]}}
    var p=d3.scale.linear(),q=d3.scale.linear(),r=[],e,t=!1,h=d3.dispatch("drag"),v=d3.behavior.drag().on("drag",function(a){a.textOffset=[d3.event.x,d3.event.y].map(Math.round);d3.select(this).call(g,a.textOffset);h.drag()}).origin(function(a){return{x:a.textOffset[0],y:a.textOffset[1]}}),w=d3.behavior.drag().on("drag",function(a){a.pos=[d3.event.x,d3.event.y].map(Math.round);var b=d3.select(this.parentNode),c="",d=b.selectAll("circle").data();"A"==d[0].type?c=u(d):d.forEach(function(a){c=c+a.type+a.pos});
        b.select("path").attr("d",c).datum().path=c;d3.select(this).call(g,a.pos);h.drag()}).origin(function(a){return{x:a.pos[0],y:a.pos[1]}}),f=function(a){e=a.selectAll("g").data(r);e.exit().remove();e.enter().append("g");e.call(g,function(a){return[p(a),q(a)]});a=e.append("text").call(g,k("textOffset")).text(k("text"));e.append("path").attr("d",k("path"));t&&(e.style("cursor","pointer"),a.call(v),e.selectAll("circle").data(function(a){var c=[];if(~a.path.indexOf("A"))var d=d3.select(this.parentNode).select("path").node(),
        f=d.getTotalLength(),c=[0,.5,1].map(function(a){a=d.getPointAtLength(a*f);return{pos:[a.x,a.y],type:"A"}});else{for(var e=1,g="M",k=0,l=1;l<a.path.length;l++){var h=a.path[l];","==h&&k++;if("L"==h||"C"==h||2==k)c.push({pos:a.path.slice(e,l).split(","),type:g}),g=h,e=l+1,k=0}c.push({pos:a.path.slice(e,l).split(","),type:g})}return c}).enter().append("circle").attr({r:8,fill:"rgba(0,0,0,0)",stroke:"#333","stroke-dasharray":"2 2"}).call(g,k("pos")).call(w),h.drag())};f.annotations=function(a){if("undefined"==
        typeof a)return r;r=a;return f};f.x=function(a){if("undefined"==typeof a)return p;p=a;return f};f.y=function(a){if("undefined"==typeof a)return q;q=a;return f};f.draggable=function(a){if("undefined"==typeof a)return t;t=a;return f};return d3.rebind(f,h,"on")};